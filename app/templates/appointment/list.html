{% extends "base.html" %}
{% block content %}
<div class="flex justify-between items-center mb-8">
    <div>
        <h2 class="text-2xl font-display font-bold text-slate-800">Appointments</h2>
        <p class="text-slate-500 text-sm">Scheduled visits and consultations</p>
    </div>
    <a href="{{ url_for('appointment.book_appointment') }}"
        class="px-5 py-2.5 bg-gradient-to-r from-primary to-secondary text-white font-bold rounded-lg shadow-lg hover:shadow-primary/40 transform hover:-translate-y-0.5 transition-all flex items-center">
        <i class="fa-solid fa-plus mr-2"></i> New Booking
    </a>
</div>

<div class="grid grid-cols-1 gap-4">
    {% for apt in appointments %}
    <div
        class="glass p-4 rounded-xl border border-slate-200 hover:shadow-md transition-all flex flex-col md:flex-row md:items-center justify-between group bg-white">

        <div class="flex items-center mb-4 md:mb-0">
            <!-- Date Box -->
            <div
                class="flex flex-col items-center justify-center h-16 w-16 bg-slate-50 rounded-lg text-slate-700 font-display border border-slate-200 mr-4">
                <span class="text-xs text-slate-500 uppercase">{{ apt.date_time.strftime('%b') }}</span>
                <span class="text-xl font-bold">{{ apt.date_time.day }}</span>
            </div>

            <div>
                <div class="flex items-center mb-1">
                    {% if current_user.role == 'doctor' %}
                    <h3 class="text-lg font-bold text-slate-800 mr-3">
                        {% if apt.patient %}
                        {{ apt.patient.name }}
                        {% else %}
                        <span class="text-slate-400 italic">Unknown Patient</span>
                        {% endif %}
                    </h3>
                    {% else %}
                    <h3 class="text-lg font-bold text-slate-800 mr-3">Dr. {{ apt.doctor.user.username }}</h3>
                    {% endif %}

                    <span class="text-xs px-2 py-0.5 rounded border font-medium
                        {% if apt.status == 'Scheduled' %} border-yellow-500 text-yellow-600 bg-yellow-50 
                        {% elif apt.status == 'Completed' %} border-green-500 text-green-600 bg-green-50 
                        {% else %} border-red-500 text-red-600 bg-red-50 {% endif %}">
                        {{ apt.status }}
                    </span>
                </div>
                <p class="text-sm text-slate-500"><i class="fa-regular fa-clock mr-1"></i> {{
                    apt.date_time.strftime('%I:%M %p') }} &bull; {{ apt.doctor.specialization }}</p>
            </div>
        </div>

        <div class="flex items-center justify-between md:justify-end w-full md:w-auto">
            <div class="mr-6 text-sm text-slate-500 truncate max-w-[200px]">
                "{{ apt.reason }}"
            </div>

            <div class="flex space-x-2 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                <a href="{{ url_for('appointment.update_appointment', appointment_id=apt.id) }}"
                    class="h-8 w-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-primary hover:text-white transition-colors flex items-center justify-center">
                    <i class="fa-solid fa-pen"></i>
                </a>
                <form action="{{ url_for('appointment.delete_appointment', appointment_id=apt.id) }}" method="POST"
                    class="inline">
                    <button type="button"
                        onclick="if(confirm('Are you sure you want to cancel this appointment?')) this.form.submit();"
                        class="h-8 w-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-red-500 hover:text-white transition-colors flex items-center justify-center">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>

    </div>
    {% else %}
    <div class="py-16 text-center text-slate-500 glass rounded-xl border border-slate-200 border-dashed">
        <i class="fa-regular fa-calendar-xmark text-4xl mb-4 opacity-50"></i>
        <p>No appointments scheduled.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}